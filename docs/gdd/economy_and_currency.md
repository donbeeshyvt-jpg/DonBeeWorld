# 冬蜜大陸世界 GDD：經濟與貨幣設計

> 版本：0.2.0  
> 更新日期：2025-11-12

## 1. 雙貨幣綱要

| 名稱 | 取得途徑 | 主要用途 | 特殊規則 |
| --- | --- | --- | --- |
| 金幣 (Coin) | 任務、採集、冒險、聊天活動、玩家交易找零 | 商店購買、玩家交易、拍賣、強化、修裝 | 可與魂幣互換，找零時優先用金幣 |
| 魂幣 (Soul Coin) | 贊助、季票、GM 活動、Boss 副本掉落碎片 | 限定商品、魂幣商店、保底交易、緊急復活 | 支援找零：魂幣付款 → 金幣找零（依匯率） |

- 匯率紀錄於 `currency_rates`，GM 可即時調整；所有交易動態讀取最新匯率。
- 贊助流程支援多通路（綠界、Discord Boost、實體序號），透過後台兌換為魂幣。

## 2. 交易與市場互通

### 2.1 NPC 商店

- 物品配置由 `npc_stores` 與 `shop_items` 控制，支援金幣、魂幣、混合付款。
- GM 可對單一商品設定：
  - 價格與貨幣類型
  - 日補貨量與重置時間
  - 限購數量（玩家/帳號/伺服器）
  - 階段性折扣（活動期間）

### 2.2 世界市場（玩家交易）

- 採用掛單制，玩家可設定數量、最低售價、匯率鎖定。
- 市場價格波動參考供需、GM 設定的波動係數、事件加成。
- 支援 `魂幣` 或 `金幣` 購買；若掛單貨幣與玩家持有不一致，系統自動依匯率換算。

### 2.3 股市系統

- GM 可建立「市場項目」：
  - 基礎價 (`base_price`)
  - 浮動範圍 (`min_delta`, `max_delta`)
  - 波動模型（線性、隨機游走、事件觸發）
- 每日排程更新 `market_ticks`，計算新價並推送至公告/Discord。
- 玩家可買入、賣出、設停損；交易寫入 `market_orders` 與 `market_order_history`。

## 3. 贊助與魂幣流程

1. 玩家點擊酒館內的「贊助」按鈕，選擇方案（金額、獎勵）。
2. 完成支付後，後端建立 `sponsorship_orders` 與 `currency_transactions`。
3. 魂幣入帳，並顯示於玩家錢包；可觸發魂幣專屬禮包。
4. 若玩家使用魂幣購買商品但需找零，系統依匯率折換金幣並產生 `currency_exchange_logs`。

## 4. GM 管理工具

- 調整匯率：即時更新 `currency_rates`，並記錄審計。
- 發放補償：可指定帳號、角色或全伺服器，快速分配金幣/魂幣/道具。
- 市場監控：查看熱門商品、魂幣流向、掛單量、異常交易。
- 股市事件：新增突發事件（如「史萊姆谷天然災害」）影響特定商品價格。
- 設定 NPC：調整商店庫存、對話、限定交易條件。

## 5. 資料表重點

- `currencies`：定義貨幣種類（Coin, Soul），支援未來擴充。
- `wallets`：紀錄每個帳號/角色的貨幣餘額，支援鎖定欄位（交易中凍結）。
- `transactions`：所有貨幣流動紀錄，包含來源、用途、相關活動 ID。
- `market_items` / `market_ticks` / `market_orders`：市場與股市核心資料。
- `sponsorship_orders`：贊助請求與支付狀態。
- `currency_exchange_logs`：找零與匯率換算紀錄。

## 6. 經濟平衡建議

- 定期檢視金幣/魂幣的流入流出比，調整任務、活動、贊助獎勵。
- 使用 BI 報表（如 Superset/Metabase）監控價格趨勢、交易熱度。
- 強化反外掛機制：監測異常交易、短時間內大量魂幣轉移。
- 推出季節性活動（如「冬蜜豐收祭」）提升金幣消耗、引導魂幣使用。

> 詳細欄位請參考 `docs/data/specs/` 內的模板；所有與經濟相關的 API 定義會在 `docs/architecture/services/economy.md` 說明。*** End Patch

